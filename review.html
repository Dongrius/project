<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>予約画面</title>
    <link rel="stylesheet" href="review.css">
    <!-- Font Awesome CDN (아이콘을 위한 외부 라이브러리) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
</head>
<body>
    <div class="container">
        <h1>予約管理とレビュー</h1>

        <!-- 訪れた店のリスト (방문한 가게 목록) -->
        <div class="store-list" id="storeList">
            <!-- 訪れた店の項目がここに追加されます (방문한 가게 항목이 여기에 추가됩니다) -->
        </div>
    </div>

    <!-- レビュー モーダル (리뷰 모달) -->
    <div id="reviewModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <h3>レビューを作成</h3>
            <label for="reviewTitle">店名</label>
            <input type="text" id="reviewTitle" disabled>
            <label for="reviewText">レビュー内容</label>
            <textarea id="reviewText" rows="4" required placeholder="レビューを入力してください"></textarea>

            <!-- ファイル添付 (파일 첨부) -->
            <div class="file-input">
                <label for="reviewFile">添付ファイル</label>
                <input type="file" id="reviewFile">
            </div>

            <!-- タグ追加入力 (태그 추가 입력) -->
            <div class="tags-input-container">
                <input type="text" id="tagsInput" placeholder="タグを入力してください">
                <button id="addTagButton" style="width:15%;"><i class="fas fa-arrow-right"></i></button>
            </div>

            <!-- タグ表示 (태그 표시) -->
            <div class="tags-container" id="tagsContainer">
                <!-- ここに追加されたタグが表示されます (여기에 추가된 태그가 표시됩니다) -->
            </div>

            <!-- 星評価 (별 평가) -->
            <div class="star-rating">
                <i class="fa fa-star star" data-value="1"></i>
                <i class="fa fa-star star" data-value="2"></i>
                <i class="fa fa-star star" data-value="3"></i>
                <i class="fa fa-star star" data-value="4"></i>
                <i class="fa fa-star star" data-value="5"></i>
            </div>

            <button id="submitReview">レビューを送信</button>
        </div>
    </div>
	
	<!-- HTML 부분에 수정 모달 추가 -->
	<div id="editReviewModal" style="display: none;">
		<h2>レビューを修正</h2>
		<input type="text" id="editReviewTitle" placeholder="店舗名" />
		<textarea id="editReviewText" placeholder="レビュー内容"></textarea>
		<input type="file" id="editReviewFile" />
		<div class="stars">
			<span class="star" data-value="1">★</span>
			<span class="star" data-value="2">★</span>
			<span class="star" data-value="3">★</span>
			<span class="star" data-value="4">★</span>
			<span class="star" data-value="5">★</span>
		</div>
		<button id="submitEditReview">修正を送信</button>
		<button onclick="closeEditModal()">閉じる</button>
	</div>

    <script>
        // サンプルデータ (샘플 데이터)
        const stores = [
            { name: '店1', dateVisited: '2025-01-01' },
            { name: '店2', dateVisited: '2025-01-10' },
            { name: '店3', dateVisited: '2025-01-15' }
        ];

        const today = new Date();
        let selectedRating = 0;
        let tags = [];

        // レビューモーダルを開く (리뷰 모달 열기)
        function openModal(storeName, visitedDate) {
            const visitDate = new Date(visitedDate);
            const dateDiff = Math.floor((today - visitDate) / (1000 * 60 * 60 * 24)); // 일 수 계산

            if (dateDiff <= 30) {
                document.getElementById('reviewTitle').value = storeName;
                document.getElementById('reviewModal').style.display = 'flex';
            } else {
                alert('レビューは30日以内にのみ作成できます。');
            }
        }

        // レビュー送信 (리뷰 보내기)
        document.getElementById('submitReview').addEventListener('click', function () {
            const reviewText = document.getElementById('reviewText').value;
            const reviewFile = document.getElementById('reviewFile').files[0];
            if (reviewText && selectedRating > 0) {
                if (reviewFile) {
                    alert(`レビューが送信されました！ 添付ファイル: ${reviewFile.name}, 星評価: ${selectedRating}, タグ: ${tags.join(', ')}`);
                } else {
                    alert(`レビューが送信されました！ 星評価: ${selectedRating}, タグ: ${tags.join(', ')}`);
                }
                closeModal();
            } else {
                alert('レビュー内容を入力し、星評価を選択してください。');
            }
        });

        // モーダルを閉じる (모달 닫기)
        function closeModal() {
            document.getElementById('reviewModal').style.display = 'none';
        }

        // 星評価クリック処理 (별 클릭 처리)
        const stars = document.querySelectorAll('.star');
        stars.forEach(star => {
            star.addEventListener('click', function () {
                selectedRating = parseInt(this.getAttribute('data-value'));
                updateStars();
            });
        });

        // 星評価の更新 (별 평가 업데이트)
        function updateStars() {
            stars.forEach(star => {
                if (parseInt(star.getAttribute('data-value')) <= selectedRating) {
                    star.classList.add('selected');
                } else {
                    star.classList.remove('selected');
                }
            });
        }

        // タグ追加 (태그 추가)
        document.getElementById('addTagButton').addEventListener('click', function () {
            const tagInput = document.getElementById('tagsInput');
            const tagValue = tagInput.value.trim();
            if (tagValue) {
                tags.push(tagValue);
                tagInput.value = '';
                updateTags();
            }
        });

        // タグ表示の更新 (태그 표시 업데이트)
        function updateTags() {
            const tagsContainer = document.getElementById('tagsContainer');
            tagsContainer.innerHTML = '';
            tags.forEach(tag => {
                const tagElement = document.createElement('div');
                tagElement.classList.add('tag');
                tagElement.textContent = tag;
                tagsContainer.appendChild(tagElement);
            });
        }
		
		 let editingReviewIndex = -1; // 수정할 리뷰의 인덱스

		// 수정 모달을 열기 위한 함수
		function openEditModal(index) {
			const review = reviews[index]; // reviews 배열에서 수정할 리뷰 가져오기
			editingReviewIndex = index; // 수정할 리뷰 인덱스 저장
			document.getElementById('editReviewTitle').value = review.title;
			document.getElementById('editReviewText').value = review.text;
			// 별점 및 파일은 필요에 따라 처리
			document.getElementById('editReviewModal').style.display = 'flex';
		}

		// 수정된 리뷰를 저장하는 함수
		document.getElementById('submitEditReview').addEventListener('click', function () {
			const editedReviewText = document.getElementById('editReviewText').value;
			const editedReviewFile = document.getElementById('editReviewFile').files[0];
			if (editedReviewText) {
				// 수정된 리뷰 내용 업데이트
				reviews[editingReviewIndex].text = editedReviewText;
				// 파일 처리 로직 추가 가능
				alert(`レビューが修正されました！ 星評価: ${selectedRating}`);
				closeEditModal();
				renderStoreList(); // 리뷰 목록 다시 렌더링
			} else {
				alert('レビュー内容を入力してください。');
			}
		});

		// 수정 모달 닫기
		function closeEditModal() {
			document.getElementById('editReviewModal').style.display = 'none';
		}

		// 訪れた店の項目をレンダリング (방문한 가게 항목 렌더링, 수정 버튼 추가)
		function renderStoreList() {
			const storeListContainer = document.getElementById('storeList');
			storeListContainer.innerHTML = ''; // 기존 내용 초기화
			stores.forEach((store, index) => {
				const storeItem = document.createElement('div');
				storeItem.classList.add('store-item');
				storeItem.innerHTML = `
					<span>${store.name} (${store.dateVisited})</span>
					<button onclick="openModal('${store.name}', '${store.dateVisited}')">レビューを作成</button>
					<button onclick="openEditModal(${index})">修正</button> <!-- 수정 버튼 추가 -->
				`;
				storeListContainer.appendChild(storeItem);
			});
		}

	   // ページロード時に店舗リストをレンダリング (페이지 로드시 가게 목록 렌더링)
		renderStoreList();

    </script>
</body>
</html>